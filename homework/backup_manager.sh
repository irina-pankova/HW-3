#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞
if [ -z "$1" ]; then
  echo "‚ùå –£–∫–∞–∂–∏—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è."
  exit 1
fi

SOURCE_DIR="$1"
BACKUP_DIR="$HOME/backup_$(date +%Y-%m-%d_%H-%M-%S)"
LOG_FILE="$BACKUP_DIR/backup.log"

# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
mkdir -p "$BACKUP_DIR"

echo "üîπ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞—Ç–æ: $(date)" | tee -a "$LOG_FILE"
echo "üîπ –ò—Å—Ö–æ–¥–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $SOURCE_DIR" | tee -a "$LOG_FILE"
echo "üîπ –ö–∞—Ç–∞–ª–æ–≥ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π: $BACKUP_DIR" | tee -a "$LOG_FILE"
echo "--------------------------------------" | tee -a "$LOG_FILE"

# –°—á—ë—Ç—á–∏–∫ —Ñ–∞–π–ª–æ–≤
count=0

# –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
for file in "$SOURCE_DIR"/*; do
  if [ -f "$file" ]; then
    filename=$(basename "$file")
    cp "$file" "$BACKUP_DIR/${filename%.*}_$(date +%Y-%m-%d).${filename##*.}"
    echo "‚úî –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: $filename" >> "$LOG_FILE"
    ((count++))
  fi
done

echo "--------------------------------------" | tee -a "$LOG_FILE"
echo "üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: $(date)" | tee -a "$LOG_FILE"
echo "–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: $count" | tee -a "$LOG_FILE"
echo "--------------------------------------" | tee -a "$LOG_FILE"

echo "‚úÖ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ."
echo "üìÅ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: $BACKUP_DIR"
echo "üìù –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π: $LOG_FILE"

